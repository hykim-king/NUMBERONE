<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pcwk.ehr.mapper.MemberMapper">

    <!-- 결과 매핑 정의 -->
    <resultMap id="MemberResultMap" type="com.pcwk.ehr.member.domain.Member">
        <result column="member_id" property="memberId"/>
        <result column="loc_code" property="locCode"/>
        <result column="password" property="password"/>
        <result column="name" property="name"/>
        <result column="nickname" property="nickname"/>
        <result column="is_admin" property="isAdmin"/>
    </resultMap>

    <!-- ID 중복 체크 쿼리 -->
    <select id="idDuplicateCheck" parameterType="String" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE member_id = #{memberId}
    </select>

    <!-- 단건 조회 쿼리 -->
    <select id="doSelectOne" parameterType="String" resultMap="MemberResultMap">
        SELECT
            member_id AS memberId,
            loc_code AS locCode,
            password,
            name,
            nickname,
            is_admin AS isAdmin
        FROM member
        WHERE member_id = #{memberId}
    </select>

    <!-- 전체 조회 쿼리 -->
    <select id="getAll" resultMap="MemberResultMap">
        SELECT
            member_id AS memberId,
            loc_code AS locCode,
            password,
            name,
            nickname,
            is_admin AS isAdmin
        FROM member
    </select>

    <!-- 전체 회원 수 조회 쿼리 -->
    <select id="getCount" resultType="int">
        SELECT COUNT(*)
        FROM member
    </select>

    <!-- 전체 데이터 삭제 쿼리 -->
    <delete id="deleteAll">
        DELETE FROM member
    </delete>

    <!-- 단건 저장 쿼리 -->
    <insert id="doSave" parameterType="com.pcwk.ehr.member.domain.Member">
        INSERT INTO member (
            member_id,
            loc_code,
            password,
            name,
            nickname,
            is_admin
        ) VALUES (
            #{memberId},
            #{locCode},
            #{password},
            #{name},
            #{nickname},
            #{isAdmin}
        )
    </insert>

    <!-- 데이터 업데이트 쿼리 -->
    <update id="doUpdate" parameterType="com.pcwk.ehr.member.domain.Member">
        UPDATE member
        SET
            loc_code = #{locCode},
            password = #{password},
            name = #{name},
            nickname = #{nickname},
            is_admin = #{isAdmin}
        WHERE member_id = #{memberId}
    </update>

    <!-- 다건 저장 쿼리 -->
    <insert id="multipleSave" parameterType="java.util.List">
        INSERT INTO member (
            member_id,
            loc_code,
            password,
            name,
            nickname,
            is_admin
        ) VALUES
        <foreach collection="list" item="member" separator=",">
            (#{member.memberId},
            #{member.locCode},
            #{member.password},
            #{member.name},
            #{member.nickname},
            #{member.isAdmin})
        </foreach>
    </insert>

    <!-- 데이터 조회 쿼리 -->
    <select id="doRetrieve" parameterType="com.pcwk.ehr.cmn.Search" resultType="Member">
        SELECT
            member_id AS memberId,
            loc_code AS locCode,
            password,
            name,
            nickname,
            is_admin AS isAdmin
        FROM member
        WHERE
            <if test="searchCondition != null">
                ${searchCondition} LIKE CONCAT('%', #{searchKeyword}, '%')
            </if>
        ORDER BY
            <if test="sortField != null">
                ${sortField} ${sortOrder}
            </if>
    </select>

</mapper>
